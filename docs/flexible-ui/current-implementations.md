# Component Builder Suite - Current Implementations Analysis

This document provides a comprehensive overview of how the component builder suite is implemented across controllers in the application. Each controller action is analyzed to show which components are used and how they are configured.

## Overview

The application uses a flexible UI system based on the `ComponentBuilder` service and the `mobile-entry.flexible` view. Controllers build arrays of components that are rendered dynamically, providing a consistent and maintainable UI architecture.

## Available Components

The ComponentBuilder service provides the following component types:

- **Navigation**: Date-based navigation with prev/next/center buttons
- **Title**: Page titles with optional subtitles and back buttons
- **Messages**: Success, error, warning, info, and tip messages
- **Summary**: Key-value pairs displayed as cards
- **Button**: Action buttons (links or form submissions)
- **ItemList**: Filterable, searchable lists with create functionality
- **Form**: Complex forms with various field types
- **Table**: Data tables with clickable rows and actions
- **Chart**: Interactive charts (line, bar, etc.)
- **PRCards**: Personal record display cards
- **CalculatorGrid**: 1RM percentage calculator grids
- **Markdown**: Rendered markdown content
- **CodeEditor**: Syntax-highlighted code editors
- **QuickActions**: Action button groups
- **BulkActionForm**: Multi-item selection forms
- **SelectAllControl**: Select all/none controls

## Controller Implementations

### ExerciseController

#### `index()` - Exercise Management
**Route**: `GET /exercises`
**Components Used**:
- **Title**: "Exercises" with subtitle "Select an exercise to edit its details, or create a new one."
- **Messages**: Session flash messages (success/error/warning/info)
- **Button**: "Add Exercise" link to create form
- **ItemList**: Filterable exercise list with search, ownership labels, and create functionality
  - Configuration: Expanded state, no cancel button, unrestricted height
  - Items show exercise title, ownership (You/Everyone/User name), and link to edit

#### `create()` - Exercise Creation Form
**Route**: `GET /exercises/create`
**Components Used**:
- **Title**: "Create Exercise"
- **Messages**: Session flash messages
- **Form**: Exercise creation form (generated by ExerciseFormService)

#### `edit()` - Exercise Editing
**Route**: `GET /exercises/{exercise}/edit`
**Components Used**:
- **Title**: "Edit Exercise"
- **Messages**: Session flash messages
- **Summary**: Exercise usage statistics (user count, total logs)
- **QuickActions**: Admin actions (promote/unpromote/merge/delete)
  - Promote to global (for personal exercises)
  - Unpromote to personal (for global exercises)
  - Merge with compatible exercises
  - Delete (with validation and disabled states)
- **Form**: Exercise edit form (generated by ExerciseFormService)

#### `showLogs()` - Exercise Training History
**Route**: `GET /exercises/{exercise}/logs`
**Components Used**:
- **Title**: Exercise display name with back button (context-aware routing)
- **Messages**: Session flash messages, contextual tips for empty state
- **Button**: "Log Now" with redirect parameters
- **PRCards**: Personal records for 1-10 reps (if exercise supports PR tracking)
  - Configuration: Scrollable, shows weight/date or empty states
- **Messages**: Info/warning messages for estimated 1RM or stale data
- **CalculatorGrid**: 1RM percentage calculator with custom percentages
  - Configuration: 100% down to 45% in 5% increments
- **Chart**: Progress chart with time-based scaling
  - Configuration: Line chart, time scale (day/month based on data range), legend, label colors
- **Table**: Lift log history with date badges and actions
  - Configuration: Spaced rows, no checkboxes, context-aware actions

### WorkoutController

#### `index()` - Workout Listing
**Route**: `GET /workouts`
**Components Used**:
- **Title**: "Workouts" with subtitle "Tap a workout to edit exercises and log your lifts"
- **Button**: "Create Workout" (simple) - always shown
- **Button**: "Create Advanced Workout" - admin/impersonation only
- **Table**: Workout list with intelligent naming and exercise counts
  - Configuration: Clickable rows, wrapped text, compact mode
  - Shows generated names for simple workouts, stored names for advanced
- **Messages**: Empty state message when no workouts exist

#### `create()` - Advanced Workout Creation
**Route**: `GET /workouts/create` (Admin only)
**Components Used**:
- **Title**: "Create Workout" with subtitle "Define your workout program"
- **WOD Form**: Specialized form with embedded code editor
  - Configuration: WOD syntax mode, 600px height, line numbers, autocomplete
  - Fields: name, description, WOD syntax textarea
  - Requires: code-editor and autocomplete scripts

#### `edit()` - Advanced Workout Editing
**Route**: `GET /workouts/{workout}/edit` (Admin only)
**Components Used**:
- **Title**: Workout name with back button to workout index
- **Messages**: Session flash messages
- **Markdown**: Processed WOD display with special styling
- **Table**: Exercise list (read-only, derived from WOD syntax)
  - Configuration: Play buttons, no move/delete buttons, logged status, compact mode
- **WOD Form**: Edit form with pre-filled values and code editor
- **Form**: Delete workout form with confirmation
  - Configuration: Danger styling, confirmation message, info about preserved logs

### SimpleWorkoutController

#### `create()` - Simple Workout Creation
**Route**: `GET /workouts/create-simple`
**Components Used**:
- **Title**: "Create Workout"
- **Messages**: Info message "Select exercises below to add them to your workout."
- **ItemList**: Exercise selection list (always expanded)
  - Generated by WorkoutExerciseListService

#### `edit()` - Simple Workout Editing
**Route**: `GET /workouts/{workout}/edit-simple`
**Components Used**:
- **Title**: Generated workout label with back button
- **Messages**: Session flash messages
- **Button**: "Add Exercise" with conditional visibility
  - Configuration: Hidden if list should be expanded, add-item class
- **ItemList**: Exercise selection list with conditional expansion
- **Table**: Current workout exercises with move/delete actions
  - Configuration: Move buttons, delete buttons, play buttons, logged status

### LiftLogController

#### `create()` - Lift Log Creation
**Route**: `GET /lift-logs/create`
**Components Used**:
- Generated by LiftLogService with context-aware back buttons
- **Title**: Exercise name with back button (mobile-entry/exercises/workouts context)
- **Form**: Exercise-specific logging form with validation
- **Messages**: Contextual help and validation errors

#### `index()` - Metrics Overview
**Route**: `GET /lift-logs`
**Components Used**:
- **Title**: "Metrics" with subtitle about viewing training history
- **Messages**: Session flash messages, empty state guidance
- **Button**: "Log Now" link (empty state only)
- **ItemList**: Logged exercises list (generated by ExerciseListService)

#### `edit()` - Lift Log Editing
**Route**: `GET /lift-logs/{liftLog}/edit`
**Components Used**:
- Generated by LiftLogService with redirect parameter handling
- **Form**: Pre-filled edit form with context-aware redirects

### MobileEntryController

#### `lifts()` - Daily Lift Logging Interface
**Route**: `GET /mobile-entry/lifts`
**Components Used**:
- **Navigation**: Date-based navigation (prev/today/next)
  - Configuration: Conditional next button (disabled for today/future)
- **Title**: Date-based title with intelligent formatting
- **Messages**: Interface messages, contextual help, validation errors
- **Summary**: Daily statistics (calories, exercises, sets, etc.)
- **Button**: "Add Exercise" with conditional visibility
- **ItemList**: Exercise selection with filtering and create functionality
  - Configuration: Conditional expansion based on metrics-first flow
- **Form**: Multiple lift logging forms for selected exercises
- **Table**: Previously logged items with edit/delete actions

### LabsController

#### Various Demo Methods
**Routes**: `/labs/*`
**Components Used**: 
- Comprehensive examples of all component types
- **Navigation**: Date navigation examples
- **Title**: Various title configurations
- **Messages**: All message types (success, error, warning, info, tip)
- **Summary**: Multi-item summaries with different data types
- **Button**: Various button configurations and states
- **ItemList**: Different list configurations and states
- **Form**: Complex forms with all field types
- **Table**: Various table layouts and configurations
- **Chart**: Different chart types and configurations

### ExerciseMatchingAliasController

#### `create()` - Exercise Alias Linking
**Route**: `GET /exercise-matching-alias/create`
**Components Used**:
- **Title**: Dynamic title with alias name and back button
- **Messages**: Info message about alias creation process
- **ItemList**: Exercise selection for alias linking
  - Generated by ExerciseListService with alias-specific configuration

### IngredientController

#### `index()` - Ingredient Management
**Route**: `GET /ingredients`
**Components Used**:
- **Title**: "Ingredients" with management subtitle
- **Messages**: Session flash messages
- **Button**: "Add Ingredient" creation link
- **ItemList**: Ingredient list with filtering and search

#### `create()` - Ingredient Creation
**Route**: `GET /ingredients/create`
**Components Used**:
- **Title**: "Create Ingredient"
- **Form**: Ingredient creation form (generated by service)

#### `edit()` - Ingredient Editing
**Route**: `GET /ingredients/{ingredient}/edit`
**Components Used**:
- **Title**: "Edit Ingredient"
- **Messages**: Session flash messages
- **Form**: Ingredient edit form (generated by service)

### MealController

#### `edit()` - Meal Editing
**Route**: `GET /meals/{meal}/edit`
**Components Used**:
- **Title**: "Edit Meal" with formatted date
- **Form**: Meal edit form (generated by MealFormService)

### FoodLogController

#### `edit()` - Food Log Editing
**Route**: `GET /food-logs/{foodLog}/edit`
**Components Used**:
- **Title**: "Edit Food Log" with formatted date/time
- **Form**: Food log edit form (generated by service)

### BodyLogController

#### `index()` - Body Measurement Logging
**Route**: `GET /body-logs`
**Components Used**:
- **Title**: "Body Measurements" with date-based subtitle
- **Messages**: Session flash messages
- **Form**: Body measurement logging form
- **Table**: Previous measurements with edit/delete actions

### UserController

#### `index()` - User Management (Admin)
**Route**: `GET /users`
**Components Used**:
- **Title**: "User Management" with admin subtitle
- **Messages**: Session flash messages
- **Button**: "Create User" link (admin only)
- **Table**: User list with roles and management actions

#### `create()` - User Creation (Admin)
**Route**: `GET /users/create`
**Components Used**:
- **Title**: "Create User"
- **Messages**: Session flash messages
- **Form**: User creation form with role selection

#### `edit()` - User Editing (Admin)
**Route**: `GET /users/{user}/edit`
**Components Used**:
- **Title**: "Edit User" with username
- **Messages**: Session flash messages
- **Form**: User edit form with role management
- **Form**: Delete user form with confirmation

### ProfileController

#### `edit()` - Profile Management
**Route**: `GET /profile/edit`
**Components Used**:
- **Title**: "Profile Settings"
- **Messages**: Session flash messages
- **Form**: Profile edit form (generated by ProfileFormService)
- **Form**: Delete account form with confirmation

## Common Patterns

### Component Configuration Patterns

1. **Title Components**: Almost always include contextual back buttons with intelligent routing
2. **Message Components**: Consistently use session flash message integration
3. **Button Components**: Frequently use conditional visibility and context-aware styling
4. **ItemList Components**: Often include filtering, search, and create functionality
5. **Form Components**: Generated by dedicated service classes for consistency
6. **Table Components**: Use consistent row builders and action patterns

### Service Integration

- **ComponentBuilder**: Central service for all component creation
- **Form Services**: Dedicated services for complex forms (ExerciseFormService, etc.)
- **List Services**: Specialized services for item lists (ExerciseListService, etc.)
- **Redirect Service**: Handles context-aware redirects after form submissions

### State Management

- **Session Messages**: Consistent flash message handling across all controllers
- **Conditional Rendering**: Components adapt based on user roles, data state, and context
- **Context Awareness**: Back buttons and redirects adapt to user navigation flow

### Accessibility

- **ARIA Labels**: Consistent labeling for screen readers
- **Semantic Structure**: Proper heading hierarchy and landmark usage
- **Keyboard Navigation**: Focus management and keyboard accessibility

## Best Practices Observed

1. **Consistent Component Usage**: All controllers follow similar patterns for component creation
2. **Service Delegation**: Complex component generation delegated to specialized services
3. **Context Awareness**: Components adapt to user context and navigation flow
4. **Progressive Enhancement**: Components work without JavaScript but enhance with it
5. **Responsive Design**: Components adapt to different screen sizes and devices
6. **Error Handling**: Consistent error message display and validation feedback
7. **Performance**: Lazy loading and conditional rendering for better performance

## Scripts and Assets

### Required JavaScript Files
- `mobile-entry.js`: Core functionality for all flexible UI components
- `mobile-entry/components/code-editor.js`: Code editor functionality
- `mobile-entry/components/code-editor-autocomplete.js`: Autocomplete features

### CSS Files
Component-specific stylesheets are automatically loaded:
- Navigation, title, messages, summary, button, table, form, list, badges
- Collapsible, PR cards, calculator grid, chart, markdown, code editor, quick actions

### Auto-loading Mechanism
The flexible view automatically collects and loads required scripts based on component `requiresScript` properties.

## Conclusion

The component builder suite provides a robust, flexible, and maintainable approach to UI development. The consistent patterns across controllers demonstrate the effectiveness of this architecture in creating a cohesive user experience while maintaining code reusability and developer productivity.